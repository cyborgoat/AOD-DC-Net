# An End-to-end Image Dehazing System with Light-weighted CNN And Dark Channel Prior

## Contributors

Instructor: Joseph Konan

Team: Jingsi Chen,Junxiao Guo, Shuhao Ren ,Luo Yu (ordered by last name initials)

## How to Run the code

```
$ python3 model_train.py
$ python3 run_dehazer.py
```

## Data Extraction

### Datasets
- [NYU-Depth V2 data set](https://cs.nyu.edu/~silberman/datasets/nyu_depth_v2.html)
- [Google Street View Dataset](https://www.crcv.ucf.edu/projects/GMCP_Geolocalization/#Dataset)
- Image Structure: 1281*1025

### Data Splitting

- Please refer to folder [data_preprocess](preprocessing)
- Used `SubsetRandomSampler` from `torch.utils.data.sampler` to split data
- Current distribution 8:2 (Train:Validation)

### Data Visualization

- Please refer to folder [data_preprocess](preprocessing)


### Create Foggy Image
- Please refer to folder [haze_generator](haze_generator)
 

#### Baseline Model Result on NYU-Depth V2 data set Dataset

- Description: left(hazy image),middle(image generated by model),right(original image)
<img src="imgs/1.jpg " alt="clear_demo" width="1000" height="200"/>
<img src="imgs/2.jpg " alt="clear_demo" width="1000" height="200"/>
<img src="imgs/3.jpg " alt="clear_demo" width="1000" height="200"/>
<img src="imgs/4.jpg " alt="clear_demo" width="1000" height="200"/>


#### Baseline Model Result on Google Street View Dataset

Clear Image

<img src="imgs/5_epoches_clear.jpg " alt="clear_demo" width="1000" height="200"/>

Hazy Image

<img src="imgs/5_epoches_hazy.jpg " alt="hazy_demo" width="1000" height="200"/>

Baseline Model Result

Note
  - The model was trained with 5 epoch from 2300 images.
  
<img src="imgs/5_epoches_clean.jpg " alt="clean_demo" width="1000" height="200"/>


### Dark Channel Prior

- The following are examples of generated dark channel prior image for future use
  
Original Image

<img src="imgs/dark/010017_1.jpg " alt="clean_demo" width="600" height="450"/>

Dark Channel Prior Image

<img src="imgs/dark/dark_010017_1.jpg " alt="clean_demo" width="600" height="450"/>
